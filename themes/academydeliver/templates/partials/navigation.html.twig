{% if page.header.navigation.maxdepth %}
  {% set maxdepth = page.header.navigation.maxdepth %}
{% else %}
  {% set maxdepth = config.site.navigation.maxdepth %}
{% endif %}
{% set depth = 1 %}

{% macro loop(page, maxdepth, depth) %}
    {% for p in page.children %}
        {% if p.visible %}
            {% set current_page = (p.active or p.activeChild) ? 'active' : '' %}
            <li class="{{ current_page }}">
                <a href="{{ p.url }}">
                    {% if p.header.icon %}<i class="fa fa-{{ p.header.icon }}"></i>{% endif %}
                    {{ p.menu }}
                </a>
                {% if p.children.count > 0 and depth < maxdepth %}
                    <ul>
                        {{ _self.loop(p, maxdepth, (depth + 1)) }}
                    </ul>
                {% endif %}
            </li>
        {% endif %}
    {% endfor %}
{% endmacro %}

<ul class="navigation">
    {% if config.themes.academydeliver.dropdown.enabled %}
        {{ _self.loop(pages, maxdepth, depth) }}
    {% else %}
        {% for page in pages.children %}
            {% if page.visible and page.slug != 'home' %}
                {% set current_page = (page.active or page.activeChild) ? 'active' : '' %}
                <li class="{{ current_page }}">
                    <a href="{{ page.url }}">
                        {% if page.header.icon %}<i class="fa fa-{{ page.header.icon }}"></i>{% endif %}
                        {{ page.menu }}
                    </a>
                </li>
            {% endif %}
        {% endfor %}
    {% endif %}
    {% for mitem in site.menu %}
        <li>
            <a href="{{ mitem.url }}">
                {% if mitem.icon %}<i class="fa fa-{{ mitem.icon }}"></i>{% endif %}
                {{ mitem.text }}
            </a>
        </li>
    {% endfor %}
</ul>
